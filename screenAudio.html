<!DOCTYPE html>
<html>
  <head>
    <title>System Audio Capture</title>
  </head>
  <body>
    <button id="startCapture">Start Capture</button>
    <button id="stopCapture" style="display: block">Stop Capture</button>
    <video id="video"></video>
    <script>
      let mediaRecorder;
      let audioChunks = [];

      const startCaptureButton = document.getElementById("startCapture");
      const stopCaptureButton = document.getElementById("stopCapture");

      async function startCapture() {
        try {
          const constraints = {
            audio: true,
            //     video: { displaySurface: "monitor" },
          };

           const streamGetInputAudio = await navigator.mediaDevices.getUserMedia(constraints); // allows you to get user audio from input devices
          // const streamGetOutputAudio = await navigator.mediaDevices.getDisplayMedia(
          //   constraints,
          // );

          //mediaRecorder = new MediaRecorder(stream);
          mediaRecorderInputAudio = new MediaRecorder(streamGetInputAudio);

          // mediaRecorder.ondataavailable = (event) => {
          //   if (event.data.size > 0) {
          //      audioChunks.push(event.data);
          //    }
          //   };

          mediaRecorderInputAudio.ondataavailable = (event) => {
            if (event.data.size > 0) {
              audioChunks.push(event.data);
            }
          };

          /*  mediaRecorder.onstop = () => {
            const audioBlob = new Blob(audioChunks, { type: "audio/wav" });
            const audioUrl = URL.createObjectURL(audioBlob);
            const audioElement = new Audio(audioUrl);
            audioElement.controls = true;
            document.body.appendChild(audioElement);

            startCaptureButton.style.display = "block";
            stopCaptureButton.style.display = "none";
          };*/
          mediaRecorderInputAudio.onstop = () => {
            const audioBlob = new Blob(audioChunks, { type: "audio/wav" });
            const audioUrl = URL.createObjectURL(audioBlob);
            const audioElement = new Audio(audioUrl);
            audioElement.controls = true;
            document.body.appendChild(audioElement);

            startCaptureButton.style.display = "block";
            stopCaptureButton.style.display = "none";
          };

          //mediaRecorder.start();
          mediaRecorderInputAudio.start();

          startCaptureButton.style.display = "none";
          stopCaptureButton.style.display = "block";
        } catch (error) {
          console.error("Error capturing system audio:", error);
        }
      }

      startCaptureButton.addEventListener("click", startCapture);

      stopCaptureButton.addEventListener("click", () => {
        mediaRecorderInputAudio.stop();
    //    mediaRecorder.stop();
      });
    </script>
  </body>
</html>
